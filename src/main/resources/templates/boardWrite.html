<!DOCTYPE html>
<html lang="kr" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">
<head>
    <title text="동행 구하기"></title>
    <style>
        .form-container {
            display: flex;
        }
    </style>
    <script src="/static/js/board.js"></script>
</head>
<body style="padding-top: 130px;">
<th:block layout:fragment="content">
    <div class="container board-detail">
        <h1 class="mt-4">동행 구하기</h1>
        <div class="card mb-4">
            <div class="card-body">
                <form th:action="@{'/boards'}" th:method="post" id="postForm">
                    <input type="hidden" name="_method" value="post"/>
                    <div class="mb-3">
                        <label for="country" class="form-label">나라</label>
                        <select class="form-select" id="country" name="country" required>
                            <option value="">나라를 선택하세요</option>
                            <option th:each="country : ${countries}"
                                    th:value="${country.getId()}"
                                    th:text="${country.getName()}" />
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="category" class="form-label">카테고리</label>
                        <select class="form-select" id="category" name="category" required>
                            <option value="">카테고리를 선택하세요</option>
                            <option th:each="category : ${categories}"
                                    th:value="${category.getId()}"
                                    th:text="${category.getCategory()}" />
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="title" class="form-label">제목</label>
                        <input type="text" class="form-control" id="title" name="title" required>
                    </div>
                    <div class="mb-3">
                        <label for="content" class="form-label">내용</label>
                        <textarea class="form-control" id="content" name="content" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="people" class="form-label">총 인원수</label>
                        <input type="text" class="form-control" id="people" name="people" required>
                    </div>
                    <div class="mb-3">
                        <label for="startDate" class="form-label">시작일</label>
                        <input type="date" class="form-control" id="startDate" name="startDate" required>
                    </div>
                    <div class="mb-3">
                        <label for="endDate" class="form-label">종료일</label>
                        <input type="date" class="form-control" id="endDate" name="endDate" required>
                    </div>
                    <div class="mb-3">
                        <label for="status" class="form-label">상태</label>
                        <input type="text" class="form-control" id="status" name="status" value="모집중" disabled>
                    </div>
<!--                    <div class="mb-3">-->
<!--                        <label for="views" class="form-label">조회수</label>-->
<!--                        <input type="text" class="form-control" id="views" name="views" th:value="${dto.views}" disabled>-->
<!--                    </div>-->
                    <div class="mb-3">
                        <label for="createdAt" class="form-label">작성일</label>
                        <input type="text" class="form-control" id="createdAt" name="createdAt" disabled>
                    </div>
                </form>
                <div class="form-container">
                    <a href="/accompany" class="btn btn-outline-secondary" style="margin-right: 6px;">목록</a>
                    <button class="btn btn-primary" id="postButton" style="margin-right: 6px;">글쓰기</button>
                </div>
            </div>
        </div>
    </div>
</th:block>
<script>
    const postForm = document.getElementById('postForm');
    const postButton = document.getElementById('postButton');

    postButton.addEventListener("click", function (event) {
        event.preventDefault();
        const formData = new FormData(postForm);

        // 선택된 값을 Long 형으로 파싱
        const selectedCountry = document.getElementById("country").value;
        const country = parseInt(selectedCountry);
        const selectedCategory = document.getElementById("category").value;
        const category = parseInt(selectedCategory);

        // FormData에 Long 형식의 'country' 값을 추가
        formData.append('country', country);
        formData.append('category', category);

        console.log(Object.fromEntries(formData.entries()))

        if (confirm("게시물을 등록하시겠습니까?")) {
            fetch(`/boards`, {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + accessToken,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(Object.fromEntries(formData.entries()))
            })
                .then(response => {
                    if (response.ok) {
                        alert('게시물이 등록되었습니다.');
                        location.reload();
                    } else {
                        alert('게시물 등록에 실패했습니다.');
                    }
                })
                .catch(error => {
                    console.error('Network error:', error);
                });
        }
    });
</script>
</body>
</html>